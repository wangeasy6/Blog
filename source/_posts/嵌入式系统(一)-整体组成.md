---
title: 嵌入式系统(一)-整体组成
date: 2020-11-25 22:40:12
toc: true
categories:
  - Technology
tags:
  - 嵌入式
---

![embedded_system_1.jpg](/resources/Cover/embedded_system_1.jpg)

系统移植，内核裁剪，是嵌入式软件工程师有别于Java、Android等软件工程师的一个重要技能。对于Linux系统的理解和操作能力，体现了一个嵌入式工程师的水平。

作为一个嵌入式软件出道，现在做了横跨C、C#、Python的纯软类工程师来说，一直怕陷入一种模棱两不可的尴尬境地。

而且最近回顾这两年发的Blog，确实技术门槛偏低，想要在一两个领域深耕一下，作为老本行的嵌入式系统就是一个很好的方向。

手上有一块iTop-4412的开发板，那么开搞。

<!--more-->

<br/>

## 一个基础的Linux系统

花了一天的时间编译并烧写了一个基础的Linux系统。一个基础的Linux系统由3个部分组成：BootLoader、Kernel、File System。

### 组成

* BootLoader基于Uboot，生成uboot.bin文件；
* Kernel基于Linux Kernel 3.x，生成zImage文件；
* File System基于Busybox，生成“bin linuxrc sbin usr”等文件夹，添加一些配置文件，再使用make_ext4fs，生成system.img文件；

<br/>

### 烧写

* 首先在Ubuntu中使用mkuboot工具烧写uboot.bin到TF卡，TF卡分区，TF卡启动盘制作完成；
* 将其他系统文件放到TF卡"/sdupdate"目录；
* 拨码到TF卡启动，使用"sdfuse flashall"命令烧写到eMMC；
* 拨码到eMMC启动，启动-系统运行。

<br/>

### 启动过程

1. 设备上电后，CPU开始运行，通常CPU会从某一个固定的物理地址开始运行，这个物理地址一般是Flash芯片的起始物理地址，通常存放的是BootLoader，于是设备启动首先运行BootLoader。
2. 在BootLoader中完成CPU和相关硬件的初始化之后，再将操作系统映像装载到内存中，然后跳转到操作系统所在的空间，启动操作系统运行。
3. Linux内核代码开始执行，会先进行内核各个子系统初始化，如果CPU带有MMU单元，完成对MMU的初始化。然后初始化多个驱动程序。接下来Linux内核会挂载根文件系统，要挂载的根文件系统是通过内核启动参数来获取的。
4. 之后会启动第一个应用程序，它的进程ID为1。这个应用程序一般由内核启动参数传入，如果没有则会默认执行/sbin/init。init进程会读取配置文件/etc/inittab，根据配置文件的内容它会完成两个工作，执行rcS和启动Shell。至此，Linux系统已经启动完成，给用户提供了一个Shell的交互环境，后续的行为就取决于用户的输入或者系统特定应用的加载。

<br/>

## 参考

《iTOP-4412系列开发板实战教程》